@using Sandbox.UI;

@namespace GameJam.UI
@inherits Image

@code {

	private readonly List<Texture> _textures = new();

	private float _changeDelay = 1;
	private int _index;
	private RealTimeUntil _next = 0.5f;

	public void AddTexture( Texture texture )
	{
		_textures.Add( texture );
		Next();
	}

	public override void Tick()
	{
		base.Tick();

		if ( _next )
			Next();
	}

	private void Next()
	{
		_next = _changeDelay;
		_index++;
		if ( _index >= _textures.Count )
			_index = 0;
		if ( _textures.Count != 0 )
			Texture = _textures[_index];
	}

	public override void SetProperty( string name, string value )
	{
		base.SetProperty( name, value );

		switch ( name )
		{
			case "delay":
				_changeDelay = value.ToFloat( 1 );
				break;
			case "src":
				var texture = Texture.Load( FileSystem.Mounted, value );
				if ( texture == null )
				{
					Log.Warning( $"Couldn't load texture @ {value}" );
					return;
				}
				AddTexture( texture );
				break;
		}
	}

}
