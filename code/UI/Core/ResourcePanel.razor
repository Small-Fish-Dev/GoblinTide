@using Sandbox.UI;
@using GameJam.UI.Core;

@namespace GameJam
@inherits Panel

<style>
    ResourcePanel { 
        position: relative;
        background-color: #2c2825cc;
        box-shadow: 0px 0px 45px #00000096;
        margin: 5px;
        transform: rotate(3deg);
        width: 96px;
        height: 96px;
        backdrop-filter: blur(8px);
    }
    
	.text {
		bottom: 5px;
		right: -25px;
		WiggleText {
			position: absolute;
			bottom: 0px;
			right: 0px;
			width: 32px;
			aspect-ratio: 1;
		}
	}

	.shadow {
		transform: translate(3px 3px);
	}
    /* Why the fuck transform: translate(-50%, -50%) does not work */
    img {
        top: 50%;
        left: 50%;
        width: 78px;
        height: 78px;
        transform: translate(-50% -50%);
        transition: transform .4s ease-out;
        
        &:intro {
            transform: scale(0.4);
        }
    }
</style>

<root>
    <img src=@($"ui/resources/{ResourceName.ToLower()}.png") />
	<panel class="text">
		<WiggleText Invert="@(false)" class="shadow" Value="@(ResourceAmount.ToString())" />
		<WiggleText Value="@(ResourceAmount.ToString())" />
	</panel>
</root>

@code {
    public string ResourceName { get; set; }

    public DateTime LastUpdate { get; private set; } = DateTime.Now;
    public int ResourceAmount { get; set; }

    public void OnValueChange(int newValue)
    {
        ResourceAmount = newValue;
        LastUpdate = DateTime.Now;
    }

    protected override int BuildHash()
    {
        return HashCode.Combine(LastUpdate);
    }
}
